<div class="interview">
  <div class="alert alert-warning" style="margin: 0;" ng-show="Auth.role === 'editor' || Auth.role === 'root'">
    <div class="container">
      <button class="btn btn-default btn-xs" ui-sref="upload.interviews({ id: interview.encodedUri })">
        <i class="fa fa-pencil"></i> Edit
      </button>
      <button class="btn btn-default btn-xs" ng-click="delete(interview)" ng-show="Auth.canDelete(interview.uri)">
        <i class="fa fa-trash-o"></i> Delete
      </button>
    </div>
  </div>
  <div class="interview-player">
    <!-- player -->
    <div class="player">
      <!-- video -->
      <div class="player-video">
        <div class="container">
          <div class="row">
            <div ng-repeat="interviewee in interview.interviewee" class="col-sm-4 col-sm-offset-4">
              <img class="media-object img-full" ng-src="{{Uris.WS_MEDIA+interviewee.media+'?dimension=360x320'}}" alt="{{interviewee.label}}">
            </div>
          </div>
        </div>
      </div>
      <!-- end of video -->
      <!-- controls -->
      <div class="player-controls">
        <div class="container">
          <div class="row">
            <div class="col-md-12 test">
              <audio data-player-control="audioPlayer" data-playlist="audioPlayerPlaylist" data-player-name="audioPlayer" audio-player id="audio1"
                controls="controls">
              </audio>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- end of interview player -->
  <!-- Interview Details -->
  <div class="l-frame l-frame-tight l-frame-highlight">
    <div class="interview-heading">
      <div class="container">
        <div ng-repeat="media in interview.media">
          <a ng-show="media.type==='Youtube'" ng-href="{{ media.url }}" target="_blank" class="pull-right">Watch on YouTube</a>
        </div>
        <h5 ng-click="isShowingInterviewDetails = !isShowingInterviewDetails" class="pull-left"
          style="margin: 0; padding: 0; position: relative; top: 3px;">
          <i class="fa fa-fw" ng-class="{'fa-chevron-right': !isShowingInterviewDetails, 'fa-chevron-down': isShowingInterviewDetails}"></i>{{
          interview.created | date:'dd MMMM yyyy' }}
        </h5>
        <div class="text-center">
          <span ng-repeat="interviewee in interview.interviewee" style="font-weight: bold;"> <a
            ng-href="#!/other/summary?otherId={{ interviewee.id }}"> {{ interviewee.label }} </a>
          </span>
        </div>
      </div>
    </div>
    <div class="interview-details" ng-show="isShowingInterviewDetails">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h5 ng-if="interview.location">Location</h5>
            <p>
              <i ng-if="interview.location" class="fa fa-map-marker"></i> <a href="http://maps.google.com/?q={{ interview.location }}" target="_blank">{{
                interview.location }}</a>
            </p>
          </div>
          <div class="col-md-6">
            <h5>Interviewers</h5>
            <ul class="media-list">
              <li class="media" ng-repeat="interviewer in interview.interviewer"><span class="pull-left"> <img
                  class="media-object img-responsive img-circle" ng-if="!interviewer.media" src="images/icon.png" style="display: block; width: 20px">
                  <img class="media-object img-responsive img-circle" ng-if="interviewer.media"
                  ng-src="{{Uris.WS_MEDIA+interviewer.media+'?dimension=20x20'}}" alt="{{ interviewer.label }}" style="width: 20px">
              </span>
                <div class="media-body">{{ interviewer.label }}</div></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="l-frame l-frame-tight">
    <!-- Interview transcript -->
    <div class="interview-transcript" ng-show="isShowingTranscript" id="transcript">
      <div class="container">
        <div class="row">
          <div class="col-sm-12">
            <div class="btn-group pull-left">
              <button type="button" class="btn btn-default" ng-model="$parent.isSyncing" btn-checkbox btn-checkbox-true="true"
                btn-checkbox-false="false" uibTooltip="Sync Transcript">
                <i class="fa fa-refresh" ng-class="{ 'fa-spin': isSyncing && audioPlayer.playing }"> </i>
              </button>
            </div>
            <div class="btn-group pull-right">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-cloud-download"></i> Download <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li ng-hide="!(interview.media|filter:{type:'Audio'}).length"><a
                  ng-href="{{Uris.WS_DOWNLOAD+(interview.media|filter:{type:'Audio'})[0].id}}" target="_blank">Audio</a></li>
                <li ng-hide="!(interview.media|filter:{type:'Transcript'}).length"><a
                  ng-href="{{Uris.WS_DOWNLOAD+(interview.media|filter:{type:'Transcript'})[0].id}}" target="_blank">Transcript</a></li>
              </ul>
            </div>
            <div class="input-group" style="padding: 0 15px;">
              <span class="input-group-addon"><i class="fa fa-search"></i> </span> <input type="text" class="form-control"
                placeholder="Search transcript" ng-model="transcriptSearchInput" ng-change="transcriptSearchInputChanged(transcriptSearchInput)"
                ng-keydown="transcriptSearchKeydown($event)">
            </div>
          </div>
        </div>
        <!-- exchanges -->
        <div infinite-scroll="addMoreExchanges()" class="interview-exchanges" style="margin-top: 24px;">
          <div ng-repeat="exchange in interview.transcript | filter:timeFilter | limitTo:exchangeDisplayCount" class="row exchange"
            ng-class="{'exchange-searching': isSearching}" id="{{ exchange.id }}" style="margin-bottom: 20px">
            <!-- transcript -->
            <div class="col-sm-6">
              <div class="media">
                <div class="pull-left" style="text-align: center">
                  <img
                    ng-if="(interview.interviewer|filter:{id:exchange.speakerid})[0].media||(interview.interviewee|filter:{id:exchange.speakerid})[0].media"
                    class="media-object exchange-dp"
                    ng-src="{{Uris.WS_MEDIA+((interview.interviewer|filter:{id:exchange.speakerid})[0].media||(interview.interviewee|filter:{id:exchange.speakerid})[0].media)+'?dimension=32x28'}}"
                    alt="" style="width: 32px" /> <img
                    ng-if="!((interview.interviewer|filter:{id:exchange.speakerid})[0].media||(interview.interviewee|filter:{id:exchange.speakerid})[0].media)"
                    class="media-object exchange-dp" src="images/icon.png" alt="" style="width: 32px" />
                  <!-- play button -->
                  <button class="btn btn-xs btn-default exchange-play" ng-click="playFromExchange(exchange)">
                    <i class="fa fa-play"></i>
                  </button>
                  <a ui-sref="other.interview({time: exchange.startTime})" class="btn btn-link exchange-play"><i class="fa fa-link"></i></a>
                  <!-- end of play button -->
                </div>
                <div class="media-body">
                  <div class="media-heading">
                    <strong> <a ui-sref="other.summary({otherId: exchange.speakerid})"> {{ exchange.speaker }} </a> <span
                      ng-show="!exchange.speaker"> {{ exchange.speakerInitials }} </span>
                    </strong> <span class="pull-right" ng-show="isSearching">{{ exchange.time }}</span>
                  </div>
                  <p ng-bind-html="exchange.transcript | highlight:transcriptSearchInput" ng-class="{ highlight: startTime == exchange.startTime }"></p>
                </div>
              </div>
            </div>
            <!-- end of transcript -->
            <!-- relationships -->
            <div class="col-sm-6">
              <div class="panel panel-default" ng-hide="(isSearching || !Auth.auth ) && !exchange.relationships.length">
                <div class="panel-heading" ng-if="(Auth.role === 'editor' || Auth.role === 'root') && Auth.auth && !isSearching">
                  <!-- Control buttons -->
                  <span ng-hide="exchange.isAddingRelationship || exchange.isEditingRelationships || exchange.isCreatingEntity">
                    <button type="button" class="btn btn-default btn-xs" ng-click="showAddRelationship(exchange)">
                      <i class="fa fa-plus fa-fw"></i>
                    </button>
                    <button type="button" class="btn btn-default btn-xs" ng-click="showEditRelationships(exchange)"
                      ng-show="exchange.relationships.length">
                      <i class="fa fa-pencil fa-fw"></i>
                    </button>
                  </span>
                  <button type="button" class="btn btn-primary btn-xs" ng-click="hideEditRelationships(exchange)"
                    ng-show="exchange.isEditingRelationships">
                    <i class="fa fa-check fa-fw"></i>
                  </button>
                  <!-- /Control Buttons -->
                  <form name="exchange.$entityForm" ng-show="exchange.isCreatingEntity">
                    <div class="form-group">
                      <label>Type<i class="fa fa-asterisk fa-asterisk-required"></i></label>
                      <div ui-select2="typeSelect" ng-model="exchange.$entityForm[Uris.RDF_TYPE]" class="form-control"></div>
                    </div>
                    <div class="form-group"
                      ng-if="((exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_EDUCATIONAL_INSTITUTION) || 
                    									(exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_ORGANISATION) || 
                    									(exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_GOVERNMENT_INSTITUTION))">
                      <label>Name<i class="fa fa-asterisk fa-asterisk-required"></i></label> <input type="text"
                        ng-model="exchange.$entityForm[Uris.FOAF_NAME]" class="form-control" placeholder="Name">
                    </div>
                    <div class="form-group" ng-if="exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_PUBLICATION_TYPE">
                      <label>Title<i class="fa fa-asterisk fa-asterisk-required"></i></label> <input type="text"
                        ng-model="exchange.$entityForm[Uris.QA_CITATION]" class="form-control" placeholder="Title">
                    </div>
                    <div class="form-group" ng-if="exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_EVENT_TYPE">
                      <label>Title<i class="fa fa-asterisk fa-asterisk-required"></i></label> <input type="text"
                        ng-model="exchange.$entityForm[Uris.QA_EVENT_TITLE]" class="form-control" placeholder="Title">
                    </div>
                    <div class="form-group" ng-if="exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_AWARD_TYPE">
                      <label>Title<i class="fa fa-asterisk fa-asterisk-required"></i></label> <input type="text"
                        ng-model="exchange.$entityForm[Uris.QA_AWARD_TITLE]" class="form-control" placeholder="Title">
                    </div>
                    <div class="form-group"
                      ng-if="((exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_PLACE_TYPE) ||
                    									(exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_STRUCTURE_TYPE))">
                      <label>Name<i class="fa fa-asterisk fa-asterisk-required"></i></label> <input type="text"
                        ng-model="exchange.$entityForm[Uris.QA_LABEL]" class="form-control" placeholder="Name">
                    </div>
                    <div class="form-group" ng-if="exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_TOPIC_TYPE">
                      <label>Topic Heading<i class="fa fa-asterisk fa-asterisk-required"></i></label> <input type="text"
                        ng-model="exchange.$entityForm[Uris.QA_TOPIC_HEADING]" class="form-control" placeholder="Topic Heading">
                    </div>
                    <div class="form-group" ng-if="exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_FIRM_TYPE">
                      <label>Name<i class="fa fa-asterisk fa-asterisk-required"></i></label> <input type="text"
                        ng-model="exchange.$entityForm[Uris.QA_FIRM_NAME]" class="form-control" placeholder="Name">
                    </div>
                    <div class="form-group"
                      ng-if="((exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.FOAF_PERSON_TYPE) || 
                    									(exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_ARCHITECT_TYPE) || 
                    									(exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_PROFESSIONAL_TYPE) || 
                    									(exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_ACADEMIC_TYPE))">
                      <label>Name<i class="fa fa-asterisk fa-asterisk-required"></i></label>
                      <div class="row">
                        <div class="col-sm-6">
                          <input type="text" ng-model="exchange.$entityForm[Uris.FOAF_FIRST_NAME]" class="form-control" placeholder="First Name">
                        </div>
                        <div class="col-sm-6">
                          <input type="text" ng-model="exchange.$entityForm[Uris.FOAF_LAST_NAME]" class="form-control" placeholder="Last Name">
                        </div>
                      </div>
                    </div>
                    <div class="form-group" ng-if="exchange.$entityForm[Uris.RDF_TYPE].uri == Uris.QA_STRUCTURE_TYPE">
                      <label>Building Typology <i class="fa fa-asterisk fa-asterisk-required"></i></label>
                      <div name="typology" ui-select2="typologySelect" ng-model="exchange.$entityForm[Uris.QA_BUILDING_TYPOLOGY_P]"
                        class="form-control required" ng-required="true"></div>
                    </div>
                    <div class="form-group">
                      <label for="summary">Summary</label>
                      <textarea ui-tinymce="tinymceOptions" rows="4" id="summary" class="form-control" placeholder="Summary"
                        ng-model="exchange.$entityForm[Uris.QA_SUMMARY]"></textarea>
                    </div>
                    <button type="submit" class="btn btn-sm btn-primary" ng-click="addEntity(exchange)">Add</button>
                    <button class="btn btn-sm btn-default" ng-click="showAddRelationship(exchange)">Cancel</button>
                  </form>
                  <!-- New relationship -->
                  <form name="exchange.$form" ng-hide="!exchange.isAddingRelationship">
                    <div class="form-group">
                      <label>Subject</label>
                      <div class="row">
                        <div class="col-sm-9">
                          <div name="subject" ui-select2="subjectSelectOptions" ng-model="exchange.newRelationship.subject" class="form-control"
                            ng-required="true"></div>
                        </div>
                        <div class="col-sm-3">
                          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                            style="width: 109px; padding-top: 4px; padding-bottom: 4px;">
                            Add New&nbsp;&nbsp;&nbsp;<span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" role="addNew">
                            <li><a ng-click="showCreateEntity(exchange, 'subject', 'Architect')" target="_blank">Architect</a></li>
                            <li><a ng-click="showCreateEntity(exchange, 'subject', 'Project')" target="_blank">Project</a></li>
                            <li><a ng-click="showCreateEntity(exchange, 'subject', 'Firm')" target="_blank">Firm</a></li>
                            <li><a ng-click="showCreateEntity(exchange, 'subject', 'Other')" target="_blank">Other</a></li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Relationship</label>
                      <div name="relationship" ui-select2="relationshipSelectOptions" ng-model="exchange.newRelationship.predicate"
                        class="form-control" ng-required="true"></div>
                    </div>
                    <div class="form-group">
                      <label>Object</label>
                      <div class="row">
                        <div class="col-sm-9">
                          <div name="object" ui-select2="objectSelectOptions" ng-model="exchange.newRelationship.object" class="form-control"
                            ng-required="true"></div>
                        </div>
                        <div class="col-sm-3">
                          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                            style="width: 109px; padding-top: 4px; padding-bottom: 4px;">
                            Add New&nbsp;&nbsp;&nbsp;<span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" role="addNew">
                            <li><a ng-click="showCreateEntity(exchange, 'object', 'Architect')" target="_blank">Architect</a></li>
                            <li><a ng-click="showCreateEntity(exchange, 'object', 'Project')" target="_blank">Project</a></li>
                            <li><a ng-click="showCreateEntity(exchange, 'object', 'Firm')" target="_blank">Firm</a></li>
                            <li><a ng-click="showCreateEntity(exchange, 'object', 'Other')" target="_blank">Other</a></li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Dates</label>
                      <div class="row">
                        <div class="col-sm-6">
                          <input name="startYear" type="number" class="form-control" placeholder="Start Year"
                            ng-model="exchange.newRelationship.startYear" />
                        </div>
                        <div class="col-sm-6">
                          <input name="endYear" type="number" class="form-control" placeholder="End Year" ng-model="exchange.newRelationship.endYear" />
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Note</label>
                      <textarea name="note" class="form-control" placeholder="Note" cols="30" rows="10" ng-model="exchange.newRelationship.note"></textarea>
                    </div>
                    <button type="submit" class="btn btn-sm btn-primary" ng-click="addRelationshipToExchange(exchange.newRelationship, exchange)"
                      ng-disabled="exchange.$form.$invalid">Add</button>
                    <button class="btn btn-sm btn-default" ng-click="hideAddRelationship(exchange)">Cancel</button>
                  </form>
                </div>
                <!-- Relationship List -->
                <ul class="list-group" ng-if="exchange.relationships.length">
                  <li class="list-group-item" ng-repeat="relationship in exchange.relationships">
                    <button class="btn btn-xs btn-danger" ng-show="exchange.isEditingRelationships" style="margin-right: 5px;"
                      ng-click="deleteRelationship(relationship, exchange)">
                      <i class="fa fa-trash-o fa-fw"></i>
                    </button> <a
                    ng-if="getRelationshipObjectType(relationship.subject)=='person'&&getRelationshipSubjectArchitect(relationship.id,relationship.subject)==true"
                    ui-sref="architect.summary({ architectId: relationship.subject })"
                    ng-bind-html="relationship.subjectlabel || '' | highlight:transcriptSearchInput"></a> <a
                    ng-if="getRelationshipSubjectType(relationship.subject)=='person'&&getRelationshipSubjectArchitect(relationship.id,relationship.subject)==false"
                    ui-sref="other.summary({ otherId: relationship.subject })"
                    ng-bind-html="relationship.subjectlabel || '' | highlight:transcriptSearchInput"></a> <a
                    ng-if="getRelationshipSubjectType(relationship.subject)=='firm'" ui-sref="firm.summary({ firmId: relationship.subject })"
                    ng-bind-html="relationship.subjectlabel || '' | highlight:transcriptSearchInput"></a> <a
                    ng-if="getRelationshipSubjectType(relationship.subject)=='structure'"
                    ui-sref="structure.summary({ structureId: relationship.subject })"
                    ng-bind-html="relationSubjectship.subjectlabel || '' | highlight:transcriptSearchInput"></a> <span
                    ng-if="getRelationshipSubjectType(relationship.subject)!= 'person'&&getRelationshipSubjectType(relationship.subject)!='firm'&&getRelationshipSubjectType(relationship.subject)!='structure'"
                    ng-bind-html="relationship.subjectlabel || '' | highlight:transcriptSearchInput"></span> <span
                    ng-bind-html="relationship.relationship || '' | highlight:transcriptSearchInput"> </span> <a
                    ng-if="getRelationshipObjectType(relationship.object)=='person'&&getRelationshipObjectArchitect(relationship.id,relationship.object)==true"
                    ui-sref="architect.summary({ architectId: relationship.object })"
                    ng-bind-html="relationship.objectlabel || '' | highlight:transcriptSearchInput"></a> <a
                    ng-if="getRelationshipObjectType(relationship.object)=='person'&&getRelationshipObjectArchitect(relationship.id,relationship.object)==false"
                    ui-sref="other.summary({ otherId: relationship.object })"
                    ng-bind-html="relationship.objectlabel || '' | highlight:transcriptSearchInput"></a> <a
                    ng-if="getRelationshipObjectType(relationship.object)=='firm'" ui-sref="firm.summary({ firmId: relationship.object })"
                    ng-bind-html="relationship.objectlabel || '' | highlight:transcriptSearchInput"></a> <a
                    ng-if="getRelationshipObjectType(relationship.object)=='structure'"
                    ui-sref="structure.summary({ structureId: relationship.object })"
                    ng-bind-html="relationObjectship.objectlabel || '' | highlight:transcriptSearchInput"></a> <span
                    ng-if="getRelationshipObjectType(relationship.object)!= 'person'&&getRelationshipObjectType(relationship.object)!='firm'&&getRelationshipObjectType(relationship.object)!='structure'"
                    ng-bind-html="relationship.objectlabel || '' | highlight:transcriptSearchInput"></span> <!-- Date --> <span
                    ng-show="relationship.from">(</span>{{ relationship.from }}<span ng-show="relationship.from && !relationship.until">)</span><span
                    ng-show="relationship.from && relationship.until"> - </span><span ng-show="!relationship.from && relationship.until">(</span>{{
                    relationship.until }}<span ng-show="relationship.until">)</span>
                  </li>
                </ul>
                <!-- /Relationship List -->
              </div>
            </div>
            <!-- end of relationships -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>